<% layout("/layouts/body", {
	title: $.targetJednostka.displayName,
	scripts: ["jednostka/page"],
	// styles: ["jednostka/page"],
	meta: {
		jednostkaID: $.targetJednostka.id
	}
}) %>
<h1 id="jednostka-title"><%= $.targetJednostka.displayName %></h1>
<% if($.targetJednostka.upperJednostki?.length > 0) { %>
	<p>(<%= $.targetJednostka.typeName %> w <%~ include("/templates/linkList", $.targetJednostka.upperJednostki.map(j => [`/jednostki/${j.id}`, j.displayName])) %>)</p>
<% } %>

<% if($.user.hasPermission($.targetJednostka.PERMISSIONS.MODIFY)) { %>
	<hr>
	<h2>
		<i>manufacturing</i>
		Ustawienia
	</h2>
	<form>
		<label for="jednostka-name-input">Nazwa:</label>
		<input
			type="text"
			id="jednostka-name-input"
			autocomplete="off"
			value="<%= $.targetJednostka.name || "" %>"
			api="jednostka/[jednostkaID]/update/name"
			<% $.user.hasPermission($.targetJednostka.PERMISSIONS.MODIFY) ? "" : "disabled" %>
		>
	</form>

	<% if($.user.hasPermission($.targetJednostka.PERMISSIONS.DELETE)) { %>
		<h3>Usuwanie</h3>
		<button id="delete-jednostka-button" class="dangerous" opens-dialog="/jednostki/<%= $.targetJednostka.id %>/delete">
			<i>delete</i>
			<span>Usuń jednostkę</span>
		</button>
	<% } %>
<% } %>

<% if($.targetJednostka.subJednostki?.length > 0 || $.user.hasPermission($.targetJednostka.PERMISSIONS.MODIFY) && $.targetJednostka.type > 0) { %>
	<hr>
	<h2>
		<i>groups</i>
		Jednostki
	</h2>
	<div id="sub-jednostka-list" class="unit-grid">
		<% for(const subJednostka of $.targetJednostka.subJednostki || []) { %>
			<% if(!subJednostka) { %>
				<div>(nieznana jednostka)</div>
			<% } else { %>
				<a href="/jednostki/<%= subJednostka.id %>">
					<h3><%= subJednostka.displayName %></h3>
					<p><%= subJednostka.typeName %></p>
				</a>
			<% } %>
		<% } %>
	</div>
	<% if($.user.hasPermission($.targetJednostka.PERMISSIONS.MODIFY) && $.targetJednostka.type > 0) { %>
		<button id="add-sub-jednostka-button" opens-dialog="/jednostki/<%= $.targetJednostka.id %>/addSubJednostka">
			<i>add</i>
			<span>Dodaj jednostkę</span>
		</button>
	<% } %>
<% } %>



<% if($.targetJednostka.funkcje?.length > 0 || $.user.hasPermission($.targetJednostka.PERMISSIONS.MODIFY)) { %>
	<hr>
	<h2>
		<i>person</i>
		Użytkownicy
	</h2>
	<div id="jednostka-member-list" class="unit-grid">
		<% for(const funkcja of $.targetJednostka.funkcje || []) { %>
			<a href="/users/<%= funkcja.user.id %>">
				<h3><%= funkcja.user.displayName %></h3>
				<p><%= Text.capitalise(funkcja.displayName) %></p>
			</a>
		<% } %>
	</div>
	<% if($.user.hasPermission($.targetJednostka.PERMISSIONS.MODIFY)) { %>
		<button opens-dialog="/jednostki/<%= $.targetJednostka.id %>/mianowanie">
			<i>add_moderator</i>
			<span>Mianuj na funkcję</span>
		</button>
		<button id="create-user-button" opens-dialog="/jednostki/<%= $.targetJednostka.id %>/createUser">
			<i>person_add</i>
			<span>Utwórz użytkownika</span>
		</button>
	<% } %>
<% } %>

<% if($.targetJednostka.wyjazdInvites?.length > 0 && $.user.hasPermission($.targetJednostka.PERMISSIONS.MODIFY)) { %>
	<hr>
	<h2>
		<i>hiking</i>
		Wyjazdy
	</h2>
	<div id="jednostka-wyjazd-list" class="unit-grid">
		<% for(const wyjazd of $.targetJednostka.wyjazdInvites || []) { %>
			<a href="/wyjazdy/<%= wyjazd.id %>">
				<h3><%= wyjazd.displayName %></h3>
				<% const invite = wyjazd.invitedJednostki.find(i => i.jednostka == $.targetJednostka.id) %>
				<% if(invite.state == "accepted") { %>
					<% if(invite.invitedUsers.length > 0) { %>
						<p>Zaproszeni uczestnicy: <%= invite.invitedUsers.length %></p>
					<% } else { %>
						<p>Zaproszenie zaakceptowane</p>
					<% } %>
				<% } else if(invite.state == "pending") { %>
					<p>Oczekujące zaproszenie...</p>
				<% } %>
			</a>
		<% } %>
	</div>
<% } %>