<% layout("/layouts/body", {
	title: `Error ${$.error.code}`,
	styles: ["error"],
	meta: {
		error: $.error.code
	}
}) %>
<h1>Error <%= $.error.code %> - <%= $.error.title %></h2>
<h2><%= $.error.message %></h2>
<% if($.error.stack) { %>
	<details>
		<summary>Szczegóły diagnostyczne</summary>
		<pre><%= $.error.stack %></pre>
		<table>
			<tr>
				<th>Strona:</th>
				<td><%= $.path || "/" %></td>
			</tr>
			<tr>
				<th>Data i godzina:</th>
				<td><%= datetime.format(new Date, "yyyy-MM-dd HH:mm:ss.SSS") %></td>
			</tr>
			<tr>
				<th>ID przeglądarki:</th>
				<td><%= $.client || "(nieznany)" %></td>
			</tr>
			<tr>
				<th>ID użytkownika:</th>
				<td><%= $.user?.id || "(nie zalogowany)" %></td>
			</tr>
			<tr>
				<th>Adres IP:</th>
				<td><%= $.ip || "(nieznany)" %></td>
			</tr>
			<tr>
				<th>Agent:</th>
				<td><%= $.userAgent || "(nieznany)" %></td>
			</tr>
			<tr>
				<th>Uprawnienia:</th>
				<td>
					<table>
						<% for(const permission of $.user.listPermissions()) { %>
							<tr>
								<td><%= permission.source?.[0] || "" %></td>
								<td><%= permission.source?.[1] || "" %></td>
								<td><%= permission.name %></td>
								<td><%= permission.state ? "✅" : "❌" %></td>
							</tr>
						<% } %>
					</table>
				</td>
			</tr>
		</table>
	</details>
<% } %>