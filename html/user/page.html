<% layout("/layouts/body", {
	title: $.targetUser.displayName,
	scripts: ["user/page"],
	styles: ["user/page"],
	meta: {
		userID: $.targetUser.id
	}
}) %>
<h1 id="user-title"><%= $.targetUser.displayName %></h1>
<div class="button-row">
	<% if($.user.id == $.targetUser.id) { %>
		<button id="logout-button" href="/logout">
			<span class="icon">logout</span>
			Wyloguj
		</button>
	<% } %>
	<% if($.user.hasPermission($.targetUser.PERMISSIONS.DELETE)) { %>
		<button id="delete-user-button" class="dangerous" api="user/[userID]/delete">
			<span class="icon">delete</span>
			Usuń użytkownika
		</button>
		<dialog id="delete-user-dialog">
			<h1>Trwale usunąć użytkownika <%= $.targetUser.displayName %>?</h1>
			<p>Użytkownik i wszystkie związane z nim dane zostaną trwale usunięte.</p>
			<div class="button-row">
				<button>
					<span class="icon">arrow_back</span>
					Anuluj
				</button>
				<button class="dangerous" command>
					<span class="icon">delete</span>
					Usuń
				</button>
			</div>
		</dialog>
	<% } %>
	<% if($.user.hasPermission($.targetUser.PERMISSIONS.MODIFY)) { %>
		<button id="generate-access-code-button" api="user/[userID]/accessCode/generate">
			<span class="icon">password</span>
			Wygeneruj kod dostępu
		</button>
		<dialog id="access-code-dialog">
			<h1>Kod dostępu</h1>
			<p>Jednorazowy kod dostępu dla użytkownika <%= $.targetUser.displayName %>:</p>
			<input type="text" id="access-code-container" disabled>
			<div class="button-row">
				<button>
					Zamknij
				</button>
			</div>
		</dialog>
	<% } %>
</div>

<hr>
<h2>Dane</h2>
<form>
	<label for="first-name-input">Imię:</label>
	<input
		type="text"
		id="first-name-input"
		autocomplete="off"
		value="<%= $.targetUser.name.first || "" %>"
		api="user/[userID]/update/names"
		name="firstName"
		<%= $.user.hasPermission($.targetUser.PERMISSIONS.MODIFY) ? "" : "disabled" %>
	>

	<label for="last-name-input">Nazwisko:</label>
	<input
		type="text"
		id="last-name-input"
		autocomplete="off"
		value="<%= $.targetUser.name.last || "" %>"
		api="user/[userID]/update/names"
		name="lastName"
		<%= $.user.hasPermission($.targetUser.PERMISSIONS.MODIFY) ? "" : "disabled" %>
	>

	<label for="date-of-birth-input">Data urodzenia:</label>
	<input
		type="date" id="date-of-birth-input"
		min="<%= MIN_DATE %>"
		max="<%= datetime.format(new Date, "yyyy-MM-dd") %>"
		<% if($.targetUser.dateOfBirth) { %>
			value="<%= datetime.format($.targetUser.dateOfBirth, "yyyy-MM-dd") %>"
		<% } %>
		api="user/[userID]/update/dateOfBirth"
		<%= $.user.hasPermission($.targetUser.PERMISSIONS.MODIFY) ? "" : " disabled" %>
	>
</form>

<% if($.targetUser.isParent) { %>
	<hr>
	<h2>Podopieczni</h2>
	<div id="child-list" class="unit-grid">
		<% for(const child of $.targetUser.children || []) { %>
			<a href="/users/<%= child.id %>"><%= child.displayName %></a>
		<% } %>
	</div>
<% } else if($.targetUser.parents.length > 0 || $.targetUser.age < 18) { %>
	<hr>
	<h2>Rodzice / opiekunowie</h2>
	<div id="parent-list" class="unit-grid">
		<% for(const parent of $.targetUser.parents || []) { %>
				<a href="/users/<%= parent.id %>"><%= parent.displayName %></a>
		<% } %>
	</div>
	<button id="add-parent-button" api="user/[userID]/parent/create">
		<span class="icon">supervisor_account</span>
		Dodaj rodzica / opiekuna
	</button>
<% } %>

<% if($.targetUser.funkcje.length > 0) { %>
	<hr>
	<h2>Funkcje</h2>
	<div id="funkcja-list" class="unit-grid">
		<% for(const funkcja of $.targetUser.funkcje) { %>
			<a href="/jednostki/<%= funkcja.jednostka?.id %>">
				<h3><%= Text.capitalise(funkcja.displayName) %></h3>
				<p><%= funkcja.jednostka?.displayName || "(nieznana jednostka)" %></p>
			</a>
		<% } %>
	</div>
<% } %>

<% if($.targetUser.funkcjeWyjazdowe.length > 0) { %>
	<hr>
	<h2>Funkcje w wyjazdach</h2>
	<div id="wyjazdowa-funkcja-list" class="unit-grid">
		<% for(const funkcja of $.targetUser.funkcjeWyjazdowe) { %>
			<a href="/wyjazdy/<%= funkcja.jednostka?.id %>">
				<h3><%= Text.capitalise(funkcja.displayName) %></h3>
				<p><%= funkcja.jednostka?.displayName || "(nieznany wyjazd)" %></p>
			</a>
		<% } %>
	</div>
<% } %>
