<% layout("/layouts/body", {
	title: "Strona gÅ‚Ã³wna",
	scripts: ["home"],
	styles: ["home"],
	navPath: false,
	user: $.user
}) %>
<h1>System Harcerski</h1>
<p id="greeting">Czuwaj<% if($.user.name.first) { %>, <a href="/users/<%= $.user.id %>"><%= $.user.name.first %></a><% } %>! ðŸ‘‹</p>
<hr>
<h2>
	<i>person</i>
	TwÃ³j profil
</h2>
<div class="unit-grid">
	<%~ include("user/templates/userEntry", {
		targetUser: $.user,
		warnings: (() => {
			// Only show warnings if user can edit their details
			if(!$.user.hasPermission($.user.PERMISSIONS.EDIT)) return
			
			const md = $.user.missingDetails
			
			return Array.conditional(
				md.includes("name"), "Brak imienia i nazwiska",
				md.includes("contact"), "Brak danych kontaktowych",
				md.includes("dob"), "Brak daty urodzenia",
				md.includes("medical"), "Nie zatwierdzone dane medyczne",
			)
		})() || []
	}) %>
</div>
<% if($.user.roles.length > 0) { %>
	<hr>
	<h2>
		<i>groups</i>
		Jednostki
	</h2>
	<div class="unit-grid">
		<% for(const role of $.user.roles) { %>
			<%~ include("unit/templates/unitEntry", {
				targetUnit: role.unit,
				warnings: Array.conditional(
					!role.unit.name, "Ustaw nazwÄ™ jednostki"
				)
			}) %>
		<% } %>
	</div>
<% } %>
<% if($.user.children.length > 0) { %>
	<hr>
	<h2>
		<i>supervisor_account</i>
		Podopieczni
	</h2>
	<div class="unit-grid">
		<% for(const child of $.user.children) { %>
			<% const md = $.user.missingDetails %>
			<%~ include("user/templates/userEntry", {
				targetUser: child,
				warnings: Array.conditional(
					md.includes("names"), "Brak imienia i nazwiska",
					md.includes("contact"), "Brak danych kontaktowych",
					md.includes("dob"), "Brak daty urodzenia",
					md.includes("medical"), "Nie zatwierdzone dane medyczne"
				)
			}) %>
		<% } %>
	</div>
<% } %>
<% if($.events.length || $.user.hasPermission(Event.PERMISSIONS.CREATE)) { %>
	<hr>
	<h2>
		<i>hiking</i>
		Akcje
	</h2>
	<div class="unit-grid">
		<% for(const event of $.events) { %>
			<%
				const inviteStates = [$.user, ...$.user.children].map(u => event.findUserInvite(u)?.state)
				const approvalState = event.getApprover($.user)?.approved

				if(approvalState === true && !inviteStates.length) continue
			%>
			<%~ include("event/templates/eventEntry", {
				targetEvent: event,
				warnings: Array.conditional(
					inviteStates.includes("pending"), "Oczekiwana odpowiedÅº",
					approvalState === false, "Oczekiwane zatwierdzenie"
				)
			}) %>
		<% } %>
	</div>
	<% if($.user.hasPermission(Event.PERMISSIONS.CREATE)) { %>
		<button id="create-event-button" opens-dialog="/events/create">
			<i>tour</i>
			<span>UtwÃ³rz akcjÄ™</span>
		</button>
	<% } %>
<% } %>