<% layout("/layouts/body", {
	title: "Strona g≈Ç√≥wna",
	scripts: ["home"],
	styles: ["home"],
	navPath: false,
	user: $.user
}) %>
<h1>System Harcerski</h1>
<p id="greeting">Czuwaj<% if($.user.name.first) { %>, <a href="/users/<%= $.user.id %>"><%= $.user.name.first %></a><% } %>! üëã</p>
<hr>
<h2>
	<i>person</i>
	Tw√≥j profil
</h2>
<% if(!$.user.name.first || !$.user.name.last) { %>
	<p class="warning">
		<i>warning</i>
		Uzupe≈Çnij swoje imiƒô i nazwisko
	</p>
<% } %>
<% if(!$.user.email || !$.user.phone) { %>
	<p class="warning">
		<i>warning</i>
		Uzupe≈Çnij sw√≥j adres e-mail i numer telefonu
	</p>
<% } %>
<% if(!$.user.medical.confirmed && $.user.funkcje.length > 0) { %>
	<p class="warning">
		<i>warning</i>
		Uzupe≈Çnij i zatwierd≈∫ swoje dane medyczne
	</p>
<% } %>
<div class="unit-grid">
	<%~ include("user/templates/userEntry", {targetUser: $.user}) %>
</div>
<% if($.user.funkcje.length > 0) { %>
	<hr>
	<h2>
		<i>groups</i>
		Jednostki
	</h2>
	<div class="unit-grid">
		<% for(const funkcja of $.user.funkcje) { %>
			<a href="/jednostki/<%= funkcja.jednostka.id %>">
				<h3><%= funkcja.jednostka.displayName %></h3>
				<p><%= funkcja.jednostka.typeName %></p>
			</a>
		<% } %>
	</div>
<% } %>
<% if(
	$.user.funkcjeWyjazdowe.length ||
	$.user.wyjazdInvites.length ||
	$.user.hasPermission(Wyjazd.PERMISSIONS.CREATE) ||
	$.user.children.some(child => child.wyjazdInvites.length)
) { %>
	<hr>
	<h2>
		<i>hiking</i>
		Wyjazdy
	</h2>
	<div class="unit-grid">
		<% for(const funkcja of $.user.funkcjeWyjazdowe) { %>
			<a href="/wyjazdy/<%= funkcja.jednostka.id %>">
				<h3><%= funkcja.jednostka.displayName %></h3>
				<p><%= funkcja.jednostka.typeName %></p>
			</a>
		<% } %>

		<% for(const targetUser of [$.user, ...$.user.children]) { %>
			<% for(const wyjazd of targetUser.wyjazdInvites) { %>
				<%~ include("user/templates/wyjazdInvite", {
					targetWyjazd: wyjazd,
					targetUser
				}) %>
			<% } %>
		<% } %>
	</div>
	<% if($.user.hasPermission(Wyjazd.PERMISSIONS.CREATE)) { %>
		<button id="create-wyjazd-button" api="wyjazd/create">
			<i>tour</i>
			<span>Nowy wyjazd</span>
		</button>
	<% } %>
<% } %>
<% if(
	$.user.wyjazdApprovalRequests.length &&
	$.user.wyjazdApprovalRequests.some(w => !w.getApprover($.user).approved)
) { %>
	<hr>
	<h2>
		<i>gavel</i>
		Wyjazdy do zatwierdzenia
	</h2>
	<div class="unit-grid">
		<% for(const wyjazd of $.user.wyjazdApprovalRequests) { %>
			<%
				const approver = wyjazd.getApprover($.user)
				if(approver.approved) continue
			%>
			<%~ include("user/templates/wyjazdApprovalRequest", {
				targetWyjazd: wyjazd,
				targetUser: $.user
			}) %>
		<% } %>
	</div>
<% } %>
<% if($.user.children.length > 0) { %>
	<hr>
	<h2>
		<i>supervisor_account</i>
		Podopieczni
	</h2>
	<% for(const child of $.user.children) { %>
		<% if(!child.name.first || !child.name.last) { %>
			<p class="warning">
				<i>warning</i>
				Uzupe≈Çnij imiƒô i nazwisko podopiecznego
			</p>
		<% } %>
		<% if(!child.dateOfBirth) { %>
			<p class="warning">
				<i>warning</i>
				Uzupe≈Çnij datƒô urodzenia podopiecznego
			</p>
		<% } %>
		<% if(!child.medical.confirmed) { %>
			<p class="warning">
				<i>warning</i>
				Uzupe≈Çnij i zatwierd≈∫ dane medyczne podopiecznego
			</p>
		<% } %>
		<% break %>
	<% } %>
	<div class="unit-grid">
		<% for(const child of $.user.children) { %>
			<%~ include("user/templates/userEntry", {targetUser: child}) %>
		<% } %>
	</div>
<% } %>